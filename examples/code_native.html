

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.2.1. Example NeXus C programs using native HDF5 commands &mdash; NeXus: Manual 3.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="NeXus: Manual 3.1 documentation" href="../index.html" />
    <link rel="up" title="2. Examples of writing and reading NeXus data files" href="index.html" />
    <link rel="next" title="2.2.2. Python Examples using h5py" href="h5py/index.html" />
    <link rel="prev" title="2.1.1. Example NeXus programs using NAPI" href="code_napi.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="h5py/index.html" title="2.2.2. Python Examples using h5py"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="code_napi.html" title="2.1.1. Example NeXus programs using NAPI"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">2. Examples of writing and reading NeXus data files</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.2.1. Example NeXus C programs using native HDF5 commands</a><ul>
<li><a class="reference internal" href="#writing-a-simple-nexus-file-using-native-hdf5-commands-in-c">2.2.1.1. Writing a simple NeXus file using native HDF5 commands in C</a></li>
<li><a class="reference internal" href="#reading-a-simple-nexus-file-using-native-hdf5-commands-in-c">2.2.1.2. Reading a simple NeXus file using native HDF5 commands in C</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="code_napi.html"
                        title="previous chapter">2.1.1. Example NeXus programs using NAPI</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="h5py/index.html"
                        title="next chapter">2.2.2. Python Examples using <tt class="docutils literal"><span class="pre">h5py</span></tt></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/examples/code_native.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="example-nexus-c-programs-using-native-hdf5-commands">
<span id="native-hdf5-examples"></span><span id="index-0"></span><h1>2.2.1. Example NeXus C programs using native HDF5 commands<a class="headerlink" href="#example-nexus-c-programs-using-native-hdf5-commands" title="Permalink to this headline">¶</a></h1>
<p>C-language code examples are provided for
writing and reading NeXus-compliant files
using the native HDF5 interfaces.  These examples are derived from the simple
NAPI examples for <a class="reference internal" href="../introduction-napi.html#fig-ex-c-write"><em>writing</em></a>
and <a class="reference internal" href="../introduction-napi.html#fig-ex-c-read"><em>reading</em></a> given in the
<a class="reference internal" href="../introduction.html#introduction"><em>Introduction</em></a> chapter.
Compare these code examples with <a class="reference internal" href="code_napi.html#napi-examples"><em>Example NeXus programs using NAPI</em></a>.</p>
<div class="section" id="writing-a-simple-nexus-file-using-native-hdf5-commands-in-c">
<span id="code-native-writing"></span><h2>2.2.1.1. Writing a simple NeXus file using native HDF5 commands in C<a class="headerlink" href="#writing-a-simple-nexus-file-using-native-hdf5-commands-in-c" title="Permalink to this headline">¶</a></h2>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</pre></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * This is an example how to write a valid NeXus file</span>
<span class="cm"> * using the HDF-5 API alone. Ths structure which is </span>
<span class="cm"> * going to be created is:</span>
<span class="cm"> *</span>
<span class="cm"> * scan:NXentry</span>
<span class="cm"> *      data:NXdata</span>
<span class="cm"> *         counts[]</span>
<span class="cm"> *            @signal=1</span>
<span class="cm"> *         two_theta[]</span>
<span class="cm"> *            @units=degrees</span>
<span class="cm"> *</span>
<span class="cm"> *  WARNING: each of the HDF function below needs to be </span>
<span class="cm"> *  wrapped into something like:</span>
<span class="cm"> *</span>
<span class="cm"> *  if((hdfid = H5function(...)) &lt; 0){</span>
<span class="cm"> *     handle error gracefully  </span>
<span class="cm"> *  }  </span>
<span class="cm"> *  I left the error checking out in order to keep the </span>
<span class="cm"> *  code clearer</span>
<span class="cm"> * </span>
<span class="cm"> *  This also installs a link from /scan/data/two_theta to /scan/hugo</span>
<span class="cm"> * </span>
<span class="cm"> *  Mark Koennecke, October 2011</span>
<span class="cm"> */</span>
<span class="p">#</span><span class="k">include</span> <span class="o">&lt;</span><span class="n">hdf5</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="p">#</span><span class="k">include</span> <span class="o">&lt;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="p">#</span><span class="k">include</span> <span class="o">&lt;</span><span class="k">string</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>

<span class="p">#</span><span class="n">define</span> <span class="no">LENGTH</span> <span class="mh">400</span>
<span class="k">int</span> <span class="n">main</span><span class="p">(</span><span class="k">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">float</span> <span class="n">two_theta</span><span class="p">[</span><span class="no">LENGTH</span><span class="p">];</span>
  <span class="k">int</span> <span class="n">counts</span><span class="p">[</span><span class="no">LENGTH</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">signal</span><span class="p">;</span>

  <span class="cm">/* HDF-5 handles */</span>
  <span class="n">hid_t</span> <span class="n">fid</span><span class="p">,</span> <span class="n">fapl</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="n">attid</span><span class="p">;</span>
  <span class="n">hid_t</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">dataspace</span><span class="p">,</span> <span class="n">dataprop</span><span class="p">,</span> <span class="n">dataid</span><span class="p">;</span>
  <span class="n">hsize_t</span> <span class="n">dim</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span> <span class="n">maxdim</span><span class="p">[</span><span class="mh">1</span><span class="p">];</span>


  <span class="cm">/* create some data: nothing NeXus or HDF-5 specific */</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="no">LENGTH</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">two_theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">+</span> <span class="mf">.1</span><span class="o">*</span><span class="n">i</span><span class="p">;</span>
    <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="k">int</span><span class="p">)(</span><span class="mh">1000</span> <span class="o">*</span> <span class="p">((</span><span class="n">float</span><span class="p">)</span><span class="n">random</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">float</span><span class="p">)</span><span class="no">RAND_MAX</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="n">dim</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="no">LENGTH</span><span class="p">;</span>
  <span class="n">maxdim</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="no">LENGTH</span><span class="p">;</span>
  <span class="n">rank</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>


 
  <span class="cm">/*</span>
<span class="cm">   * open the file. The file attribute forces normal file </span>
<span class="cm">   * closing behaviour down HDF-5&#39;s throat</span>
<span class="cm">   */</span>
  <span class="n">fapl</span> <span class="o">=</span> <span class="n">H5Pcreate</span><span class="p">(</span><span class="no">H5P_FILE_ACCESS</span><span class="p">);</span>
  <span class="n">H5Pset_fclose_degree</span><span class="p">(</span><span class="n">fapl</span><span class="p">,</span><span class="no">H5F_CLOSE_STRONG</span><span class="p">);</span>
  <span class="n">fid</span> <span class="o">=</span> <span class="n">H5Fcreate</span><span class="p">(</span><span class="s">&quot;NXfile.h5&quot;</span><span class="p">,</span> <span class="no">H5F_ACC_TRUNC</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">,</span><span class="n">fapl</span><span class="p">);</span>  
  <span class="n">H5Pclose</span><span class="p">(</span><span class="n">fapl</span><span class="p">);</span>


  <span class="cm">/*</span>
<span class="cm">   * create scan:NXentry</span>
<span class="cm">   */</span>
  <span class="n">gid</span> <span class="o">=</span> <span class="n">H5Gcreate</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;scan&quot;</span><span class="p">,</span><span class="mh">0</span><span class="p">);</span>
  <span class="cm">/*</span>
<span class="cm">   * store the NX_class attribute. Notice that you</span>
<span class="cm">   * have to take care to close those hids after use</span>
<span class="cm">   */</span>
  <span class="n">atts</span> <span class="o">=</span> <span class="n">H5Screate</span><span class="p">(</span><span class="no">H5S_SCALAR</span><span class="p">);</span>
  <span class="n">atttype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_C_S1</span><span class="p">);</span>
  <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">atttype</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&quot;NXentry&quot;</span><span class="p">));</span>
  <span class="n">attid</span> <span class="o">=</span> <span class="n">H5Acreate</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span><span class="s">&quot;NX_class&quot;</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">);</span>
  <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attid</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;NXentry&quot;</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">atts</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">atttype</span><span class="p">);</span>
  <span class="n">H5Aclose</span><span class="p">(</span><span class="n">attid</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * same thing for data:Nxdata in scan:NXentry.</span>
<span class="cm">   * A subroutine would be nice to have here.......</span>
<span class="cm">   */</span>
  <span class="n">gid</span> <span class="o">=</span> <span class="n">H5Gcreate</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;/scan/data&quot;</span><span class="p">,</span><span class="mh">0</span><span class="p">);</span>
  <span class="n">atts</span> <span class="o">=</span> <span class="n">H5Screate</span><span class="p">(</span><span class="no">H5S_SCALAR</span><span class="p">);</span>
  <span class="n">atttype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_C_S1</span><span class="p">);</span>
  <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">atttype</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&quot;NXdata&quot;</span><span class="p">));</span>
  <span class="n">attid</span> <span class="o">=</span> <span class="n">H5Acreate</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span><span class="s">&quot;NX_class&quot;</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">);</span>
  <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attid</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;NXdata&quot;</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">atts</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">atttype</span><span class="p">);</span>
  <span class="n">H5Aclose</span><span class="p">(</span><span class="n">attid</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * store the counts dataset</span>
<span class="cm">   */</span>
  <span class="n">dataspace</span> <span class="o">=</span> <span class="n">H5Screate_simple</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">maxdim</span><span class="p">);</span>
  <span class="n">datatype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_NATIVE_INT</span><span class="p">);</span>  
  <span class="n">dataprop</span> <span class="o">=</span> <span class="n">H5Pcreate</span><span class="p">(</span><span class="no">H5P_DATASET_CREATE</span><span class="p">);</span>
  <span class="n">dataid</span> <span class="o">=</span> <span class="n">H5Dcreate</span><span class="p">(</span><span class="n">gid</span><span class="p">,(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;counts&quot;</span><span class="p">,</span><span class="n">datatype</span><span class="p">,</span><span class="n">dataspace</span><span class="p">,</span><span class="n">dataprop</span><span class="p">);</span>
  <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="no">H5S_ALL</span><span class="p">,</span> <span class="no">H5S_ALL</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">,</span> <span class="n">counts</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">dataspace</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">datatype</span><span class="p">);</span>
  <span class="n">H5Pclose</span><span class="p">(</span><span class="n">dataprop</span><span class="p">);</span>  
  <span class="cm">/*</span>
<span class="cm">   * set the signal=1 attribute </span>
<span class="cm">   */</span>
  <span class="n">atts</span> <span class="o">=</span> <span class="n">H5Screate</span><span class="p">(</span><span class="no">H5S_SCALAR</span><span class="p">);</span>
  <span class="n">atttype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_NATIVE_INT</span><span class="p">);</span>
  <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">atttype</span><span class="p">,</span><span class="mh">1</span><span class="p">);</span>
  <span class="n">attid</span> <span class="o">=</span> <span class="n">H5Acreate</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span><span class="s">&quot;signal&quot;</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">);</span>
  <span class="n">signal</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
  <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attid</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">signal</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">atts</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">atttype</span><span class="p">);</span>
  <span class="n">H5Aclose</span><span class="p">(</span><span class="n">attid</span><span class="p">);</span>

  <span class="n">H5Dclose</span><span class="p">(</span><span class="n">dataid</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * store the two_theta dataset</span>
<span class="cm">   */</span>
  <span class="n">dataspace</span> <span class="o">=</span> <span class="n">H5Screate_simple</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">maxdim</span><span class="p">);</span>
  <span class="n">datatype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_NATIVE_FLOAT</span><span class="p">);</span>  
  <span class="n">dataprop</span> <span class="o">=</span> <span class="n">H5Pcreate</span><span class="p">(</span><span class="no">H5P_DATASET_CREATE</span><span class="p">);</span>
  <span class="n">dataid</span> <span class="o">=</span> <span class="n">H5Dcreate</span><span class="p">(</span><span class="n">gid</span><span class="p">,(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;two_theta&quot;</span><span class="p">,</span><span class="n">datatype</span><span class="p">,</span><span class="n">dataspace</span><span class="p">,</span><span class="n">dataprop</span><span class="p">);</span>
  <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="no">H5S_ALL</span><span class="p">,</span> <span class="no">H5S_ALL</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">,</span> <span class="n">two_theta</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">dataspace</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">datatype</span><span class="p">);</span>
  <span class="n">H5Pclose</span><span class="p">(</span><span class="n">dataprop</span><span class="p">);</span>  

  <span class="cm">/*</span>
<span class="cm">   * set the units attribute</span>
<span class="cm">   */</span>
  <span class="n">atttype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_C_S1</span><span class="p">);</span>
  <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">atttype</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&quot;degrees&quot;</span><span class="p">));</span>
  <span class="n">atts</span> <span class="o">=</span> <span class="n">H5Screate</span><span class="p">(</span><span class="no">H5S_SCALAR</span><span class="p">);</span>
  <span class="n">attid</span> <span class="o">=</span> <span class="n">H5Acreate</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span><span class="s">&quot;units&quot;</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">);</span>
  <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attid</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;degrees&quot;</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">atts</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">atttype</span><span class="p">);</span>
  <span class="n">H5Aclose</span><span class="p">(</span><span class="n">attid</span><span class="p">);</span>
 <span class="cm">/*</span>
<span class="cm">   * set the target attribute for linking</span>
<span class="cm">   */</span>
  <span class="n">atttype</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_C_S1</span><span class="p">);</span>
  <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">atttype</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="s">&quot;/scan/data/two_theta&quot;</span><span class="p">));</span>
  <span class="n">atts</span> <span class="o">=</span> <span class="n">H5Screate</span><span class="p">(</span><span class="no">H5S_SCALAR</span><span class="p">);</span>
  <span class="n">attid</span> <span class="o">=</span> <span class="n">H5Acreate</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span><span class="s">&quot;target&quot;</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="n">atts</span><span class="p">,</span> <span class="no">H5P_DEFAULT</span><span class="p">);</span>
  <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attid</span><span class="p">,</span> <span class="n">atttype</span><span class="p">,</span> <span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="s">&quot;/scan/data/two_theta&quot;</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">atts</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">atttype</span><span class="p">);</span>
  <span class="n">H5Aclose</span><span class="p">(</span><span class="n">attid</span><span class="p">);</span>


  <span class="n">H5Dclose</span><span class="p">(</span><span class="n">dataid</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * make a link in /scan to /scan/data/two_theta, thereby </span>
<span class="cm">   * renaming two_theta to hugo</span>
<span class="cm">   */</span>
  <span class="n">H5Glink</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="no">H5G_LINK_HARD</span><span class="p">,</span><span class="s">&quot;/scan/data/two_theta&quot;</span><span class="p">,</span><span class="s">&quot;/scan/hugo&quot;</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * close the file </span>
<span class="cm">   */</span>
  <span class="n">H5Fclose</span><span class="p">(</span><span class="n">fid</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="reading-a-simple-nexus-file-using-native-hdf5-commands-in-c">
<span id="code-native-reading"></span><h2>2.2.1.2. Reading a simple NeXus file using native HDF5 commands in C<a class="headerlink" href="#reading-a-simple-nexus-file-using-native-hdf5-commands-in-c" title="Permalink to this headline">¶</a></h2>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Reading example for reading NeXus files with plain</span>
<span class="cm"> * HDF-5 API calls. This reads out counts and two_theta</span>
<span class="cm"> * out of the file generated by nxh5write.</span>
<span class="cm"> *</span>
<span class="cm"> * WARNING: I left out all error checking in this example.</span>
<span class="cm"> * In production code you have to take care of those errors</span>
<span class="cm"> *</span>
<span class="cm"> * Mark Koennecke, October 2011</span>
<span class="cm"> */</span>
<span class="p">#</span><span class="k">include</span> <span class="o">&lt;</span><span class="n">hdf5</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="p">#</span><span class="k">include</span> <span class="o">&lt;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>

<span class="k">int</span> <span class="n">main</span><span class="p">(</span><span class="k">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">float</span> <span class="o">*</span><span class="n">two_theta</span> <span class="o">=</span> <span class="no">NULL</span><span class="p">;</span>
  <span class="k">int</span> <span class="o">*</span><span class="n">counts</span> <span class="o">=</span> <span class="no">NULL</span><span class="p">,</span>  <span class="n">rank</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">hid_t</span> <span class="n">fid</span><span class="p">,</span> <span class="n">dataid</span><span class="p">,</span> <span class="n">fapl</span><span class="p">;</span>
  <span class="n">hsize_t</span> <span class="o">*</span><span class="n">dim</span> <span class="o">=</span> <span class="no">NULL</span><span class="p">;</span>
  <span class="n">hid_t</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">dataspace</span><span class="p">,</span> <span class="n">memdataspace</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">   * Open file, thereby enforcing proper file close</span>
<span class="cm">   * semantics</span>
<span class="cm">   */</span>
  <span class="n">fapl</span> <span class="o">=</span> <span class="n">H5Pcreate</span><span class="p">(</span><span class="no">H5P_FILE_ACCESS</span><span class="p">);</span>
  <span class="n">H5Pset_fclose_degree</span><span class="p">(</span><span class="n">fapl</span><span class="p">,</span><span class="no">H5F_CLOSE_STRONG</span><span class="p">);</span>
  <span class="n">fid</span> <span class="o">=</span> <span class="n">H5Fopen</span><span class="p">(</span><span class="s">&quot;NXfile.h5&quot;</span><span class="p">,</span> <span class="no">H5F_ACC_RDONLY</span><span class="p">,</span><span class="n">fapl</span><span class="p">);</span>  
  <span class="n">H5Pclose</span><span class="p">(</span><span class="n">fapl</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * open and read the counts dataset</span>
<span class="cm">   */</span>
  <span class="n">dataid</span> <span class="o">=</span> <span class="n">H5Dopen</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="s">&quot;/scan/data/counts&quot;</span><span class="p">);</span>
  <span class="n">dataspace</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataid</span><span class="p">);</span>
  <span class="n">rank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">dataspace</span><span class="p">);</span>
  <span class="n">dim</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">rank</span><span class="o">*</span><span class="n">sizeof</span><span class="p">(</span><span class="n">hsize_t</span><span class="p">));</span>
  <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">dataspace</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="no">NULL</span><span class="p">);</span>
  <span class="n">counts</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="o">*</span><span class="n">sizeof</span><span class="p">(</span><span class="k">int</span><span class="p">));</span>
  <span class="n">memdataspace</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_NATIVE_INT32</span><span class="p">);</span>
  <span class="n">H5Dread</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span><span class="n">memdataspace</span><span class="p">,</span><span class="no">H5S_ALL</span><span class="p">,</span> <span class="no">H5S_ALL</span><span class="p">,</span><span class="no">H5P_DEFAULT</span><span class="p">,</span> <span class="n">counts</span><span class="p">);</span>
  <span class="n">H5Dclose</span><span class="p">(</span><span class="n">dataid</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">dataspace</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">memdataspace</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * open and read the two_theta data set</span>
<span class="cm">   */</span>
  <span class="n">dataid</span> <span class="o">=</span> <span class="n">H5Dopen</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="s">&quot;/scan/data/two_theta&quot;</span><span class="p">);</span>
  <span class="n">dataspace</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataid</span><span class="p">);</span>
  <span class="n">rank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">dataspace</span><span class="p">);</span>
  <span class="n">dim</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">rank</span><span class="o">*</span><span class="n">sizeof</span><span class="p">(</span><span class="n">hsize_t</span><span class="p">));</span>
  <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">dataspace</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="no">NULL</span><span class="p">);</span>
  <span class="n">two_theta</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="o">*</span><span class="n">sizeof</span><span class="p">(</span><span class="n">float</span><span class="p">));</span>
  <span class="n">memdataspace</span> <span class="o">=</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="no">H5T_NATIVE_FLOAT</span><span class="p">);</span>
  <span class="n">H5Dread</span><span class="p">(</span><span class="n">dataid</span><span class="p">,</span><span class="n">memdataspace</span><span class="p">,</span><span class="no">H5S_ALL</span><span class="p">,</span> <span class="no">H5S_ALL</span><span class="p">,</span><span class="no">H5P_DEFAULT</span><span class="p">,</span> <span class="n">two_theta</span><span class="p">);</span>
  <span class="n">H5Dclose</span><span class="p">(</span><span class="n">dataid</span><span class="p">);</span>
  <span class="n">H5Sclose</span><span class="p">(</span><span class="n">dataspace</span><span class="p">);</span>
  <span class="n">H5Tclose</span><span class="p">(</span><span class="n">memdataspace</span><span class="p">);</span>



  <span class="n">H5Fclose</span><span class="p">(</span><span class="n">fid</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dim</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%8.2f %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">two_theta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="h5py/index.html" title="2.2.2. Python Examples using h5py"
             >next</a> |</li>
        <li class="right" >
          <a href="code_napi.html" title="2.1.1. Example NeXus programs using NAPI"
             >previous</a> |</li>
        <li><a href="../index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >2. Examples of writing and reading NeXus data files</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2014, http://nexusformat.org.
      Last updated on 2014-10-02 14:43:08 CDT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>