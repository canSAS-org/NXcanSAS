

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.5. Verification and validation of files &mdash; NeXus: Manual 3.1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="NeXus: Manual 3.1 documentation" href="index.html" />
    <link rel="up" title="1. NeXus: User Manual" href="user_manual.html" />
    <link rel="next" title="1.6. Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="1.4. Strategies for storing information in NeXus data files" href="strategies.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="faq.html" title="1.6. Frequently Asked Questions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="strategies.html" title="1.4. Strategies for storing information in NeXus data files"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="user_manual.html" accesskey="U">1. NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.5. Verification and validation of files</a><ul>
<li><a class="reference internal" href="#overview">1.5.1. Overview</a></li>
<li><a class="reference internal" href="#definitions-of-these-terms">1.5.2. Definitions of these terms</a></li>
<li><a class="reference internal" href="#nexus-data-files-may-use-multiple-base-classes-or-application-definitions">1.5.3. NeXus data files may use multiple base classes or application definitions</a></li>
<li><a class="reference internal" href="#validation-techniques">1.5.4. Validation techniques</a><ul>
<li><a class="reference internal" href="#validation-of-nexus-data-files">1.5.4.1. Validation of NeXus data files</a></li>
<li><a class="reference internal" href="#validation-of-nexus-definition-language-nxdl-specification-files">1.5.4.2. Validation of NeXus Definition Language (NXDL) specification files</a></li>
<li><a class="reference internal" href="#validation-of-the-nxdl-rules">1.5.4.3. Validation of the NXDL rules</a></li>
<li><a class="reference internal" href="#validation-of-xslt-files">1.5.4.4. Validation of XSLT files</a></li>
<li><a class="reference internal" href="#transformation-of-nxdl-files-to-schematron">1.5.4.5. Transformation of NXDL files to Schematron</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="strategies.html"
                        title="previous chapter">1.4. Strategies for storing information in NeXus data files</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="faq.html"
                        title="next chapter">1.6. Frequently Asked Questions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/validation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="verification-and-validation-of-files">
<span id="verification"></span><span id="index-0"></span><h1>1.5. Verification and validation of files<a class="headerlink" href="#verification-and-validation-of-files" title="Permalink to this headline">¶</a></h1>
<p>The intent of verification and validation of files is to ensure, in an unbiased way, that
a given file conforms to the relevant specifications. NeXus uses various automated tools to
validate files. These tools include conversion of content from HDF to XML and transformation
(via XSLT) from XML format to another such as NXDL, XSD, and Schematron. This chapter will
first provide an overview of the process, then define the terms used in validation, then
describe how multiple base classes or application definitions might apply to a given NeXus
data file, and then describe the various validation techniques in more detail. Validation
does not check that the data content of the file is sensible; this requires scientific
interpretation based on the technique.</p>
<p>Validation is useful to anyone who manipulates or modifies the contents of NeXus files.
This includes scientists/users, instrument staff, software developers, and those who might
mine the files for  <span class="target" id="index-1"></span>metadata.
First, the scientist or user of the data must be certain that the information
in a file can be located reliably. The instrument staff or software developer must be
confident the information they have written to the file has been located and formatted
properly. At some time, the content of the NeXus file may contribute to a larger body of
work such as a metadata catalog for a scientific instrument, a laboratory, or even an entire user facility.</p>
<div class="section" id="overview">
<span id="verification-overview"></span><h2>1.5.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>NeXus files adhere to a set of  <span class="target" id="index-2"></span>rules and can be tested
against these rules for compliance. The rules are
implemented using standard tools and can themselves be tested to verify compliance with
the standards for such definitions. Validation includes the testing of both NeXus data
files and the NXDL specifications that describe the rules.</p>
<p>The rules for writing NeXus data files are different than the rules for writing NeXus
class definitions. To validate a NeXus data file, these two rule sets must eventually
merge, as shown in the next figure. The data file (either HDF4, HDF5, or XML) is first
converted into an internal format to facilitate validation, including data types, array
dimensions, naming, and other items. Most of the data is not converted since data
validation is non-trivial. Also note that the units are not validated. All the NXDL
files are converted into a single Schematron file (again, internal use for validation)
only when NXDL revisions are checked into the NeXus definitions repository as NXDL
changes are not so frequent.</p>
<div class="compound">
<div class="compound-last figure align-center" id="figure-nxvalidate">
<img alt="figure.nxvalidate" src="_images/nxvalidate1.png" style="width: 80%;" />
<p class="caption">Flowchart of the NeXus validation process.</p>
</div>
</div>
<dl class="docutils">
<dt>NeXus data files</dt>
<dd><p class="first">NeXus data files (also known as NeXus data file instances) are validated
to ensure the various parts of the data file are arranged according to the
governing NXDL <span class="target" id="index-3"></span>specifications used in that file instance.</p>
<blockquote class="last">
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since NeXus has several rules that are quite difficult to apply in
either XSD or Schematron, direct validation of data files using standard
tools is not possible. To validate NeXus data files, it is necessary to
use <tt class="docutils literal"><span class="pre">nxvalidate</span></tt>.</p>
</div>
</div></blockquote>
</dd>
<dt>NeXus Definition Language (NXDL) specification files</dt>
<dd>NXDL files are validated to ensure they adhere to the  <span class="target" id="index-4"></span>rules
for writing NeXus base classes and application definitions.</dd>
</dl>
</div>
<div class="section" id="definitions-of-these-terms">
<span id="verification-definitions"></span><h2>1.5.2. Definitions of these terms<a class="headerlink" href="#definitions-of-these-terms" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s be clear about some terms used in this section.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">HDF:</th><td class="field-body"><span class="target" id="index-5"></span>Hierarchical Data Format from The HDF Group.
NeXus data files using HDF
may be stored in either version 4 (HDF4) or version 5 (HDF5). New NeXus HDF
files should only use HDF5. The preferred file extensions
(but not required) include <tt class="docutils literal"><span class="pre">.hdf</span></tt>, <tt class="docutils literal"><span class="pre">.h5</span></tt>, <tt class="docutils literal"><span class="pre">.nxs</span></tt>, and <tt class="docutils literal"><span class="pre">.nx5</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">NXDL:</th><td class="field-body">NeXus Definition Language files define the specifications for NeXus base
classes, application definitions, and contributed classes and definitions.
It is fully described in the <a class="reference internal" href="nxdl.html#nxdl"><em>NXDL</em></a> chapter.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Schematron:</th><td class="field-body"><span class="target" id="index-6"></span>Schematron <a class="footnote-reference" href="#schematron" id="id1">[1]</a>
is an alternative to XSD and is used to validate the content
and structure of an XML file.  NeXus uses Schematron internally to
validate data files.</td>
</tr>
<tr class="field-even field"><th class="field-name">Validation:</th><td class="field-body">File validation is the comparison of file contents, in an unbiased way,
with the set of rules that define the structure of such files.</td>
</tr>
<tr class="field-odd field"><th class="field-name">XML:</th><td class="field-body">The eXtensible Markup Language (<span class="target" id="index-7"></span>XML) <a class="footnote-reference" href="#xml" id="id2">[2]</a>
is a standard business tool for the
exchange of information. It is broadly supported by a large software library
in many languages. NeXus uses XML for several purposes: data files, NXDL
definitions, rules, and XSLT transformations.</td>
</tr>
<tr class="field-even field"><th class="field-name">XSD:</th><td class="field-body">XML files are often defined by a set of rules (or
<em>schema</em>). A common language used to implement these
rules is XML Schema (<span class="target" id="index-8"></span>XSD)  <a class="footnote-reference" href="#xsd" id="id3">[3]</a>
Fundamentally, all XML, XSD, XSLT, and Schematron files are  XML.</td>
</tr>
<tr class="field-odd field"><th class="field-name">XSLT:</th><td class="field-body">XML files can be flexible enough to convert from one set of rules to
another. An example is when one company wishes to exchange catalog or
production information with another. The XML StyLsheet Transformation
(<span class="target" id="index-9"></span>XSLT) <a class="footnote-reference" href="#xslt" id="id4">[4]</a>
language is often used to describe each direction of the conversion of the
XML files between the two rule sets.</td>
</tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="schematron" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> <a class="reference external" href="http://www.schematron.com">http://www.schematron.com</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="xml" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="http://www.w3schools.com/xml">http://www.w3schools.com/xml</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="xsd" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><a class="reference external" href="http://www.w3schools.com/schema">http://www.w3schools.com/schema</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="xslt" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><a class="reference external" href="http://www.w3schools.com/xsl/">http://www.w3schools.com/xsl/</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="nexus-data-files-may-use-multiple-base-classes-or-application-definitions">
<span id="verification-multipledefs"></span><h2>1.5.3. NeXus data files may use multiple base classes or application definitions<a class="headerlink" href="#nexus-data-files-may-use-multiple-base-classes-or-application-definitions" title="Permalink to this headline">¶</a></h2>
<p>NeXus data files may have more than one data set or may have multiple instances of
just about any base class or even application definitions. The NeXus data file
validation is prepared to handle this without any special effort by the provider of the
data file.</p>
<span class="target" id="verification-techniques"></span></div>
<div class="section" id="validation-techniques">
<span id="index-10"></span><h2>1.5.4. Validation techniques<a class="headerlink" href="#validation-techniques" title="Permalink to this headline">¶</a></h2>
<p>File validation is the process to determine if a given file is prepared consistent
with a set of guidelines or  <span class="target" id="index-11"></span>rules. In NeXus, there are several different types of files. First, of course, is
the data file yet it can be provided in one of several forms: HDF4, HDF5, or XML.
Specifications for data files are provided by one or (usually) more NeXus definition
files (NXDL, for short). These NXDL files are written in XML and validated by the NXDL
specification which is written in the <span class="target" id="index-12"></span>XML Schema (XSD) language.
Thus, automated file verification is available for data files, definition
files, and the rules for definition files.</p>
<span class="target" id="verification-data"></span><div class="section" id="validation-of-nexus-data-files">
<span id="index-13"></span><h3>1.5.4.1. Validation of NeXus data files<a class="headerlink" href="#validation-of-nexus-data-files" title="Permalink to this headline">¶</a></h3>
<p>Each NeXus data file can be validated against the NXDL  <span class="target" id="index-14"></span>rules.
(The full suite of NXDL specifications is converted into Schematron
rules by an  <span class="target" id="index-15"></span>XSLT transformation and then combined into a single file. It is not allowed
to have a NeXus base class and also an application definition with the same name
since one will override the other in the master Schematron file) The validation is
done using Schematron and the <tt class="docutils literal"><span class="pre">NXvalidate</span></tt> program.
<span class="target" id="index-16"></span>Schematron was selected, rather than <span class="target" id="index-17"></span>XML Schema (XSD),
to permit established rules for NeXus files, especially the rule
allowing the nodes within <tt class="docutils literal"><span class="pre">NXentry</span></tt> to appear in any order.</p>
<p>The validation process is mainly checking file structure (presence or absence of groups/fields)
- it is usually impossible to check the actual data itself,
other than confirm that it is of the correct data type (string, float etc.). The only exception is when
the NXDL specification is either a fixed value or an enumeration - in which case the data
is checked.</p>
<p>During validation, the NeXus data file instance (either HDF or XML) is first converted
into an XML file in a form that facilitates validation (e.g with large numeric data removed).  Then the
XML file is validated by Schematron against the <tt class="docutils literal"><span class="pre">schema/all.sch</span></tt>
file.</p>
<span class="target" id="verification-nxdl"></span></div>
<div class="section" id="validation-of-nexus-definition-language-nxdl-specification-files">
<span id="index-18"></span><h3>1.5.4.2. Validation of NeXus Definition Language (NXDL) specification files<a class="headerlink" href="#validation-of-nexus-definition-language-nxdl-specification-files" title="Permalink to this headline">¶</a></h3>
<p>Each NXDL file must be validated against the  <span class="target" id="index-19"></span>rules
that define how NXDL files are to be arranged. The NXDL rules are
specified in the form of <span class="target" id="index-20"></span>XML Schema (XSD).</p>
<p>Standard tools (validating editor or command line or support library) can be used
to validate any NXDL file. Here&#8217;s an example using <tt class="docutils literal"><span class="pre">xmllint</span></tt>
from a directory that contains <tt class="docutils literal"><span class="pre">nxdl.xsd</span></tt>,
<tt class="docutils literal"><span class="pre">nxdlTypes.xsd</span></tt>, and
<tt class="docutils literal"><span class="pre">applications/NXsas.nxdl.xml</span></tt>:</p>
<div class="compound">
<p class="compound-first rubric">Use of <tt class="docutils literal"><span class="pre">xmllint</span></tt> to validate a NXDL specification.</p>
<div class="compound-last highlight-guess"><div class="highlight"><pre><span class="n">xmllint</span> <span class="o">--</span><span class="n">noout</span> <span class="o">--</span><span class="n">schema</span> <span class="n">nxdl</span><span class="p">.</span><span class="n">xsd</span> <span class="n">applications</span><span class="o">/</span><span class="n">NXsas</span><span class="p">.</span><span class="n">nxdl</span><span class="p">.</span><span class="n">xml</span>
</pre></div>
</div>
</div>
<span class="target" id="verification-nxdl-rules"></span></div>
<div class="section" id="validation-of-the-nxdl-rules">
<span id="index-21"></span><h3>1.5.4.3. Validation of the NXDL rules<a class="headerlink" href="#validation-of-the-nxdl-rules" title="Permalink to this headline">¶</a></h3>
<p>NXDL rules are specified using the rules of <span class="target" id="index-22"></span>XML Schema (XSD).
The XSD syntax of the rules is validated using standard XML file
validation tools: either a validating editor (such as <em>oXygen</em>,
<em>xmlSpy</em>, or <em>eclipse</em>) or common
UNIX/Linux command line tools</p>
<div class="compound">
<p class="compound-first rubric">Use of <tt class="docutils literal"><span class="pre">xmllint</span></tt> to validate the NXDL rules.</p>
<div class="compound-last highlight-guess"><div class="highlight"><pre><span class="n">xmllint</span> <span class="o">--</span><span class="n">valid</span>  <span class="n">nxdl</span><span class="p">.</span><span class="n">xsd</span>
</pre></div>
</div>
</div>
<p>The validating editor method is used by the developers while the
<tt class="docutils literal"><span class="pre">xmllint</span></tt> command line tool is the automated method used by the NeXus
definitions subversion repository.</p>
<span class="target" id="verification-xslt"></span></div>
<div class="section" id="validation-of-xslt-files">
<span id="index-23"></span><h3>1.5.4.4. Validation of XSLT files<a class="headerlink" href="#validation-of-xslt-files" title="Permalink to this headline">¶</a></h3>
<p>XSLT transformations are validated using standard tools
such as a validating editor or xmllint.</p>
<span class="target" id="verification-nxdl-to-sch"></span></div>
<div class="section" id="transformation-of-nxdl-files-to-schematron">
<span id="index-24"></span><h3>1.5.4.5. Transformation of NXDL files to Schematron<a class="headerlink" href="#transformation-of-nxdl-files-to-schematron" title="Permalink to this headline">¶</a></h3>
<p>Schematron <a class="footnote-reference" href="#schematron" id="id5">[1]</a> is a rule-based language that allows very specific validation of an XML
document. Its advantages over using XSD schema are that:</p>
<ul class="simple">
<li>more specific pattern-based rules based on data content can be
written</li>
<li>full XSLT/XPath expression syntax available for writing validation
tests</li>
<li>error messages can be customised and thus more meaningful</li>
<li>It is easier to validate documents when entities can occur in any
order.</li>
</ul>
<p>XSD does provide a mechanism for defining a class structure and inheritance, so
its usage within NeXus in addition to schematron has not been ruled out. But for a
basic validation of file content, schematron looks best.</p>
<p>The NXDL definition files are converted into a set of Schematron
<span class="target" id="index-25"></span>rules using the <tt class="docutils literal"><span class="pre">xslt/nxdl2sch.xsl</span></tt> XSLT stylesheet. The NeXus
instance file (either in XML, HDF4, or HDF5)
is turned into a reduced XML validation file.
This file is very similar to a pure NeXus XML file, but with additional metadata for
dimensions and also with most of the actual numeric data removed.</p>
<p>The validation process then compares the set of Schematron rules against the
<em>reduced XML</em> validation file. Schematron itself is
implemented as a set of XSLT transforms. NeXus includes the Schematron files, as
well as the Java based XSLT engine <tt class="docutils literal"><span class="pre">saxon</span></tt>.</p>
<p>The java based
<tt class="docutils literal"><span class="pre">nxvalidate</span></tt> GUI can be run to validate files.</p>
<p>Currently, the structure of the file is validated (i.e. valid names are used at
the correct points), but this will be extended to array dimensions
and <span class="target" id="index-26"></span>link targets.
Error messages are printed about missing mandatory fields, and informational
messages are printed about fields that are neither optional or mandatory (in case
they are a typing error). Even non-standard names must comply with a set of rules
(e.g. no spaces are allowed in names). Enumerations are checked that they conform to
an allowed value. The data type is checked and the units will also be checked.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="faq.html" title="1.6. Frequently Asked Questions"
             >next</a> |</li>
        <li class="right" >
          <a href="strategies.html" title="1.4. Strategies for storing information in NeXus data files"
             >previous</a> |</li>
        <li><a href="index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="user_manual.html" >1. NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="copyright.html">Copyright</a> 2014, http://nexusformat.org.
      Last updated on 2014-10-02 14:43:08 CDT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>