

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.2. NeXus Design &mdash; NeXus: Manual 3.1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="NeXus: Manual 3.1 documentation" href="index.html" />
    <link rel="up" title="1. NeXus: User Manual" href="user_manual.html" />
    <link rel="next" title="1.2.3.1. Rules for Structuring Information in NeXus Files" href="rules.html" />
    <link rel="prev" title="NAPI: The NeXus Application Programming Interface" href="introduction-napi.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="rules.html" title="1.2.3.1. Rules for Structuring Information in NeXus Files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction-napi.html" title="NAPI: The NeXus Application Programming Interface"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="user_manual.html" accesskey="U">1. NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.2. NeXus Design</a><ul>
<li><a class="reference internal" href="#nexus-objects-and-terms">1.2.1. NeXus Objects and Terms</a><ul>
<li><a class="reference internal" href="#data-groups">1.2.1.1. Data Groups</a></li>
<li><a class="reference internal" href="#data-fields">1.2.1.2. Data Fields</a></li>
<li><a class="reference internal" href="#data-attributes">1.2.1.3. Data Attributes</a></li>
<li><a class="reference internal" href="#links">1.2.1.4. Links</a></li>
<li><a class="reference internal" href="#nexus-base-classes">1.2.1.5. NeXus Base Classes</a><ul>
<li><a class="reference internal" href="#nxdata-facilitates-automatic-plotting"><tt class="docutils literal"><span class="pre">NXdata</span></tt> Facilitates Automatic Plotting</a></li>
<li><a class="reference internal" href="#where-to-store-metadata">Where to Store Metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nexus-application-definitions">1.2.1.6. NeXus Application Definitions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nexus-coordinate-systems">1.2.2. NeXus Coordinate Systems</a><ul>
<li><a class="reference internal" href="#mcstas-and-nxgeometry-system">1.2.2.1. McStas and <tt class="docutils literal"><span class="pre">NXgeometry</span></tt> System</a></li>
<li><a class="reference internal" href="#simple-spherical-polar-coordinate-system">1.2.2.2. Simple (Spherical Polar) Coordinate System</a></li>
<li><a class="reference internal" href="#coordinate-transformations">1.2.2.3. Coordinate Transformations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rules-and-underlying-file-formats">1.2.3. Rules and Underlying File Formats</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction-napi.html"
                        title="previous chapter">NAPI: The NeXus Application Programming Interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="rules.html"
                        title="next chapter">1.2.3.1. Rules for Structuring Information in NeXus Files</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/design.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="nexus-design">
<span id="design"></span><h1>1.2. NeXus Design<a class="headerlink" href="#nexus-design" title="Permalink to this headline">¶</a></h1>
<p>This chapter actually defines the rules to use for writing valid NeXus files. An explanation of NeXus objects
is followed by the definition of NeXus coordinate systems, the rules for structuring files and the rules for
storing single items of data.</p>
<p>The structure of NeXus files is extremely flexible, allowing the storage both of
simple data sets, such as a single data array and its axes, and also of highly complex
data, such as the simulation results or an entire multi-component instrument. This flexibility
is a necessity as NeXus strives to capture data from a wild variety of applications in X-ray, muSR and
neutron scattering. The flexibility is achieved through a <span class="target" id="index-0"></span>hierarchical
structure, with <span class="target" id="index-1"></span>related
<em>fields</em>  collected together into <em>groups</em>,
making NeXus files easy to navigate, even without any
documentation. NeXus files are self-describing, and should be easy to understand, at
least by those familiar with the experimental technique.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this manual, we use the terms <em>field</em>, <em>data field</em>, and
<em>data item</em> synonymously to be consistent
with their meaning between NeXus data file instances and
NXDL specification files.</p>
</div>
</div></blockquote>
<div class="section" id="nexus-objects-and-terms">
<span id="design-objects"></span><h2>1.2.1. NeXus Objects and Terms<a class="headerlink" href="#nexus-objects-and-terms" title="Permalink to this headline">¶</a></h2>
<p>Before discussing the design of NeXus in greater detail it is necessary to define the objects and terms
used by NeXus. These are:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#design-groups"><em>Data Groups</em></a></dt>
<dd>Group data fields and other groups together. Groups represent levels in the NeXus hierarchy</dd>
<dt><a class="reference internal" href="#design-fields"><em>Data Fields</em></a></dt>
<dd>Multidimensional arrays and scalars representing the actual data to be stored</dd>
<dt><a class="reference internal" href="#design-attributes"><em>Data Attributes</em></a></dt>
<dd>Additional metadata which can be assigned to groups or data fields</dd>
<dt><a class="reference internal" href="#design-links"><em>Links</em></a></dt>
<dd>Elements which point to data stored in another place in the file hierarchy</dd>
<dt><a class="reference internal" href="#design-nexusclasses"><em>NeXus Base Classes</em></a></dt>
<dd>Dictionaries of names possible in the various types of NeXus groups</dd>
<dt><a class="reference internal" href="#design-nexusapplications"><em>NeXus Application Definitions</em></a></dt>
<dd>Describe the minimum content of a NeXus file for a particular usage case</dd>
</dl>
<p>In the following sections these elements of NeXus files will be defined in more detail.</p>
<div class="section" id="data-groups">
<span id="design-groups"></span><h3>1.2.1.1. Data Groups<a class="headerlink" href="#data-groups" title="Permalink to this headline">¶</a></h3>
<p>NeXus files consist of <span class="target" id="index-2"></span>data groups,
which contain fields and/or other
groups to form a <span class="target" id="index-3"></span>hierarchical structure.
This hierarchy is designed to make it
easy to navigate a NeXus file by storing related fields together. Data
groups are identified both by a name, which must be unique within a particular
group, and a class. There can be multiple groups with the same class
but they must have different names (based on the <span class="target" id="index-4"></span>HDF rules).</p>
<p>For the class names used with NeXus data groups the prefix NX is reserved. Thus all NeXus class
names start with NX.</p>
</div>
<div class="section" id="data-fields">
<span id="design-fields"></span><span id="index-5"></span><h3>1.2.1.2. Data Fields<a class="headerlink" href="#data-fields" title="Permalink to this headline">¶</a></h3>
<p>Data fields contain the essential information stored in a NeXus file. They can
be scalar values or multidimensional arrays of a variety of sizes (1-byte,
2-byte, 4-byte, 8-byte) and types (integers, floats, characters). The fields may
store both experimental results (counts, detector angles, etc), and other
information associated with the experiment (start and end times, user names,
etc). Data fields are identified by their names, which must be unique within the
group in which they are stored.  Some fields have engineering units to be specified.
In some cases, such in <tt class="docutils literal"><span class="pre">NXdetector/data</span></tt>, a field is expected to have be
an array of several dimensions.</p>
<blockquote>
<div><div class="compound">
<p class="compound-middle rubric">Examples of data fields</p>
<dl class="compound-last docutils">
<dt><tt class="docutils literal"><span class="pre">variable</span></tt> (<em>NX_NUMBER</em>)</dt>
<dd>Dimension scale defining an axis of the data.</dd>
<dt><tt class="docutils literal"><span class="pre">variable_errors</span></tt> (<em>NX_NUMBER</em>)</dt>
<dd>Errors (uncertainties) associated with axis <tt class="docutils literal"><span class="pre">variable</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">wavelength</span></tt> (<em>NX_FLOAT</em>)</dt>
<dd>wavelength of radiation, <tt class="docutils literal"><span class="pre">units=&quot;NX_FLOAT&quot;</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">chemical_formula</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>The chemical formula specified using CIF conventions.</dd>
<dt><tt class="docutils literal"><span class="pre">name</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>Name of user responsible for this entry.</dd>
<dt><tt class="docutils literal"><span class="pre">data</span></tt> (<em>NX_NUMBER</em>)</dt>
<dd>Data values from the detector, <tt class="docutils literal"><span class="pre">units=&quot;NX_ANY&quot;</span></tt></dd>
</dl>
</div>
</div></blockquote>
</div>
<div class="section" id="data-attributes">
<span id="design-attributes"></span><h3>1.2.1.3. Data Attributes<a class="headerlink" href="#data-attributes" title="Permalink to this headline">¶</a></h3>
<p id="index-6">Attributes are extra (meta-)information that are associated with particular
fields. They are used to annotate the data, e.g. with physical
<span class="target" id="index-7"></span>units or calibration offsets, and may be scalar numbers or character
strings. In addition, NeXus uses attributes to identify
<span class="target" id="index-8"></span>plottable data
and their axes, etc. A description of some of the many possible
attributes can be found in the next table:</p>
<blockquote>
<div><div class="compound">
<p class="compound-first rubric">Examples of data attributes</p>
<dl class="compound-middle docutils">
<dt><tt class="docutils literal"><span class="pre">units</span></tt> (<em>NX_CHAR</em>)</dt>
<dd><span class="target" id="index-9"></span>Data units given as character strings,
must conform to the NeXus units standard.   See the
<a class="reference internal" href="datarules.html#design-units"><em>NeXus Data Units</em></a> section for details.</dd>
<dt><tt class="docutils literal"><span class="pre">signal</span></tt> (<em>NX_POSINT</em>)</dt>
<dd>Defines which data set contains the signal
to be <span class="target" id="index-10"></span>plotted,
use <tt class="docutils literal"><span class="pre">signal=1</span></tt> for main signal, <tt class="docutils literal"><span class="pre">signal=2</span></tt> for a second
item to plot, and so on.</dd>
<dt><tt class="docutils literal"><span class="pre">axes</span></tt> (<em>NX_CHAR</em>)</dt>
<dd><p class="first"><span class="target" id="index-11"></span>axes defines the names of the
<span class="target" id="index-12"></span>dimension scales
for this data set
as a colon-delimited list.  Note that some legacy data files
may use a comma as delimiter.</p>
<p class="last">For example, suppose <tt class="docutils literal"><span class="pre">data</span></tt> is an array with
elements <tt class="docutils literal"><span class="pre">data[j][i]</span></tt> (C) or <tt class="docutils literal"><span class="pre">data(i,j)</span></tt>
(Fortran), with dimension scales <tt class="docutils literal"><span class="pre">time_of_flight[i]</span></tt>
and <tt class="docutils literal"><span class="pre">polar_angle[j]</span></tt>,
then <tt class="docutils literal"><span class="pre">data</span></tt> would have an
attribute <tt class="docutils literal"><span class="pre">axes=&quot;polar_angle:time_of_flight&quot;</span></tt>
in addition to an attribute <tt class="docutils literal"><span class="pre">signal=1</span></tt>.</p>
</dd>
</dl>
<dl class="compound-last docutils" id="index-13">
<dt><tt class="docutils literal"><span class="pre">axis</span></tt> (<em>NX_POSINT</em>)</dt>
<dd>The original way of designating data for
<span class="target" id="index-14"></span>plotting,
now superceded by the <tt class="docutils literal"><span class="pre">axes</span></tt> attribute.
This defines the <span class="target" id="index-15"></span>rank
of the signal data for which this data set is a
<span class="target" id="index-16"></span>dimension scale
in order of the fastest varying index (see a
longer discussion in the section on <tt class="docutils literal"><span class="pre">NXdata</span></tt> structure), i.e. if
the array being stored is <tt class="docutils literal"><span class="pre">data</span></tt>, with elements
<tt class="docutils literal"><span class="pre">data[j][i]</span></tt> in C and <tt class="docutils literal"><span class="pre">data(i,j)</span></tt> in
Fortran, <tt class="docutils literal"><span class="pre">axis</span></tt> would have the following values:
ith dimension (<tt class="docutils literal"><span class="pre">axis=1</span></tt>),
jth dimension (<tt class="docutils literal"><span class="pre">axis=2</span></tt>), etc.</dd>
<dt><tt class="docutils literal"><span class="pre">primary</span></tt> (<em>NX_POSINT</em>)</dt>
<dd>Defines the order of preference
for <span class="target" id="index-17"></span>dimension scales
which apply to the same <span class="target" id="index-18"></span>rank
of signal data.  Use <tt class="docutils literal"><span class="pre">primary=1</span></tt> to indicate preferred
dimension scale</dd>
<dt><tt class="docutils literal"><span class="pre">long_name</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>Defines title of signal data or axis label of dimension scale</dd>
<dt><tt class="docutils literal"><span class="pre">calibration_status</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>Defines status of data value - set to <tt class="docutils literal"><span class="pre">Nominal</span></tt> or <tt class="docutils literal"><span class="pre">Measured</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">offset</span></tt> (<em>NX_INT</em>)</dt>
<dd>Rank values of offsets to use for each
<span class="target" id="index-19"></span>dimension
if the data is not in C storage order</dd>
<dt><tt class="docutils literal"><span class="pre">stride</span></tt> (<em>NX_INT</em>)</dt>
<dd>Rank values of steps to use when incrementing the dimension</dd>
<dt><tt class="docutils literal"><span class="pre">vector</span></tt> (<em>NX_FLOAT</em>)</dt>
<dd>3 values describing the axis of rotation
or the direction of translation</dd>
<dt><tt class="docutils literal"><span class="pre">interpretation</span></tt> (<em>NX_CHAR</em>)</dt>
<dd><p class="first">Describes how to display the data.
Allowed values include:</p>
<ul class="last simple">
<li><tt class="docutils literal"><span class="pre">scaler</span></tt> (0-D data)</li>
<li><tt class="docutils literal"><span class="pre">spectrum</span></tt> (1-D data)</li>
<li><tt class="docutils literal"><span class="pre">image</span></tt> (2-D data)</li>
<li><tt class="docutils literal"><span class="pre">vertex</span></tt> (3-D data)</li>
</ul>
</dd>
</dl>
</div>
</div></blockquote>
<span class="target" id="index-20"></span><p>Finally, NeXus files themselves have global attributes which are listed
in the next table.
These attributes identify the NeXus version, file creation time, etc.
All attributes are identified by their names, which must be unique within each field.</p>
<blockquote>
<div><div class="compound">
<p class="compound-middle rubric">Examples of global attributes</p>
<dl class="compound-middle docutils">
<dt><tt class="docutils literal"><span class="pre">file_name</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>File name of original NeXus file
to assist in identification
if the external name has been changed</dd>
</dl>
<dl class="compound-last docutils" id="index-21">
<dt><tt class="docutils literal"><span class="pre">file_time</span></tt> (<em>ISO 8601</em>)</dt>
<dd>Date and time of file creation</dd>
<dt><tt class="docutils literal"><span class="pre">file_update_time</span></tt> (<em>ISO 8601</em>)</dt>
<dd>Date and time of last file change at close</dd>
<dt><tt class="docutils literal"><span class="pre">NeXus_version</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>Version of NeXus API used in writing the file</dd>
<dt><tt class="docutils literal"><span class="pre">creator</span></tt> (<em>NX_CHAR</em>)</dt>
<dd>Facility or program where the file originated</dd>
</dl>
</div>
</div></blockquote>
</div>
<div class="section" id="links">
<span id="design-links"></span><h3>1.2.1.4. Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<p id="index-22">Links are pointers to existing data somewhere else.
The concept is very much like
symbolic links in a unix filesystem.
The NeXus definition sometimes requires to
have access to the same data in different groups
in the same file. For example: detector data is stored in the
<tt class="docutils literal"><span class="pre">NXinstrument/NXdetector</span></tt> group
but may be needed in <tt class="docutils literal"><span class="pre">NXdata</span></tt> for automatic plotting.
Rather then replicating the data, NeXus uses
links in such situations. See the <a class="reference internal" href="#fig-data-linking"><em>figure</em></a> for
a more descriptive representation of the concept of linking.</p>
<div class="compound">
<div class="compound-last figure" id="fig-data-linking">
<img alt="fig.data-linking" src="_images/data-linking.png" style="width: 60%;" />
<p class="caption">Linking in a NeXus file</p>
</div>
</div>
<p id="index-23">NeXus also allows for links to external files.
Consider the case where an instrument uses a detector with
a closed-system software support provided by a commercial vendor.
This system writes its images into a NeXus HDF5 file.
The instrument&#8217;s data acquisition system writes instrument metadata
into another NeXus HDF5 file.  In this case, the instrument metadata file
might link to the data in the detector image file.
Here is an example (from Diamond Light Source)
showing an external file link in HDF5:</p>
<blockquote>
<div><div class="compound">
<p class="compound-first rubric">Example of linking to data in an external HDF5 file</p>
<div class="compound-last highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre> <span class="n">EXTERNAL_LINK</span> <span class="s">&quot;data&quot;</span> <span class="p">{</span>
        <span class="n">TARGETFILE</span> <span class="s">&quot;/dls/i22/data/2012/sm7594-1/i22-69201-Pilatus2M.h5&quot;</span>
        <span class="n">TARGETPATH</span> <span class="s">&quot;entry/instrument/detector/data&quot;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div></blockquote>
</div>
<div class="section" id="nexus-base-classes">
<span id="design-nexusclasses"></span><h3>1.2.1.5. NeXus Base Classes<a class="headerlink" href="#nexus-base-classes" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-24"></span><p id="index-25">Data groups often describe objects in the experiment (monitors, detectors,
monochromators, etc.), so that the contents (both data fields and/or other data
groups) comprise the properties of that object. NeXus has defined a set of standard
objects, or <a class="reference internal" href="classes/base_classes/index.html#base-class-definitions"><em>base classes</em></a>,
out of which a NeXus file can be constructed. This is each data group
is identified by a name and a class. The group class, defines the type of object
and the properties that it can contain, whereas the group name defines a unique instance
of that class. These classes are
defined in XML using the NeXus Definition Language
<span class="target" id="index-26"></span>(NXDL) format. All NeXus class types adopted by the NIAC <em>must</em>
begin <span class="target" id="index-27"></span>with <tt class="docutils literal"><span class="pre">NX</span></tt>.
Classes not adopted by the NIAC <em>must not</em>
start with <tt class="docutils literal"><span class="pre">NX</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">NeXus base classes are the components used to build the
NeXus data structure.</p>
</div>
<p>Not all classes define physical objects. Some refer to logical groupings of
experimental information, such as
<span class="target" id="index-28"></span>plottable data,
sample environment logs, beam profiles, etc.
There can be multiple instances of each class. On
the other hand, a typical NeXus file will only contain a small subset of the
possible classes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The groups, fields, links, and attributes of a base class
definition are all <strong>optional</strong>, with a few particular exceptions in
<tt class="docutils literal"><span class="pre">NXentry</span></tt> and <tt class="docutils literal"><span class="pre">NXdata</span></tt>.  They are named in the specification
to describe the exact spelling and usage of the term when it appears.</p>
</div>
<p>NeXus base classes are not proper classes in the same sense as used in object oriented programming
languages. In fact the use of the term classes is actually misleading but has established itself during the
development of NeXus. NeXus base classes are rather dictionaries of field names and their meanings
which are permitted in a particular NeXus group implementing the NeXus class. This sounds complicated but
becomes easy if you consider that most NeXus groups describe instrument components. Then for example, a
NXmonochromator base class describes all the possible field names which NeXus allows to be used to describe a
monochromator.</p>
<p>Most NeXus base classes represent instrument components. Some are used as containers to structure information in a
file (<tt class="docutils literal"><span class="pre">NXentry</span></tt>, <tt class="docutils literal"><span class="pre">NXcollection</span></tt>, <tt class="docutils literal"><span class="pre">NXinstrument</span></tt>, <tt class="docutils literal"><span class="pre">NXprocess</span></tt>, <tt class="docutils literal"><span class="pre">NXparameter</span></tt>).
But there are some base classes which have special uses which need to be mentioned here:</p>
<dl class="docutils">
<dt><a class="reference internal" href="classes/base_classes/NXdata.html#nxdata"><em>NXdata</em></a></dt>
<dd><tt class="docutils literal"><span class="pre">NXdata</span></tt> is used to identify the default
<span class="target" id="index-29"></span>plottable data.
The notion of a default plot of data is a basic motivation of NeXus.</dd>
<dt><a class="reference internal" href="classes/base_classes/NXlog.html#nxlog"><em>NXlog</em></a></dt>
<dd><tt class="docutils literal"><span class="pre">NXlog</span></tt> is used to store time stamped data like the log of a temperature controller. Basically you give a start time,
and arrays with a difference in seconds to the start time and the values read.</dd>
<dt><a class="reference internal" href="classes/base_classes/NXnote.html#nxnote"><em>NXnote</em></a></dt>
<dd>This group provides a place to store general notes, images, video or whatever. A mime type is stored together
with a binary blob of data. Please use this only for auxiliary information, for example an image of your sample,
or a photo of your boss.</dd>
<dt><a class="reference internal" href="classes/base_classes/NXgeometry.html#nxgeometry"><em>NXgeometry</em></a></dt>
<dd><tt class="docutils literal"><span class="pre">NXgeometry</span></tt> and its subgroups <tt class="docutils literal"><span class="pre">NXtranslation</span></tt>,
<tt class="docutils literal"><span class="pre">NXorientation</span></tt>, <tt class="docutils literal"><span class="pre">NXshape</span></tt> are  used to store absolute positions in the
laboratory coordinate system or to define shapes.</dd>
</dl>
<p>These groups can appear anywhere in the NeXus hierarchy, where needed. Preferably close to the component they
annotate or in a <tt class="docutils literal"><span class="pre">NXcollection</span></tt>. All of the base classes are documented in the reference manual.</p>
<div class="section" id="nxdata-facilitates-automatic-plotting">
<span id="nxdata-facilitates-thedefaultplot"></span><h4><tt class="docutils literal"><span class="pre">NXdata</span></tt> Facilitates Automatic Plotting<a class="headerlink" href="#nxdata-facilitates-automatic-plotting" title="Permalink to this headline">¶</a></h4>
<p id="index-30">The most notable special base class (or <em>group</em> in NeXus) is <tt class="docutils literal"><span class="pre">NXdata</span></tt>.
<tt class="docutils literal"><span class="pre">NXdata</span></tt> is the answer to a basic motivation of NeXus to facilitate
automatic plotting of data.
<tt class="docutils literal"><span class="pre">NXdata</span></tt> is designed to contain the main dataset and its associated
dimension scales (axes) of a NeXus data file.
The usage scenario is that an automatic data plotting program just
opens a <tt class="docutils literal"><span class="pre">NXentry</span></tt> and then continues to search for any <tt class="docutils literal"><span class="pre">NXdata</span></tt>
groups. These <tt class="docutils literal"><span class="pre">NXdata</span></tt> groups represent the plottable data.
An algorithm for identifying the default plottable data
is <a class="reference internal" href="datarules.html#find-plottable-data"><em>presented</em></a> in the
chapter titled <a class="reference internal" href="datarules.html#datarules"><em>Rules for Storing Data Items in NeXus Files</em></a>.</p>
</div>
<div class="section" id="where-to-store-metadata">
<span id="id1"></span><h4>Where to Store Metadata<a class="headerlink" href="#where-to-store-metadata" title="Permalink to this headline">¶</a></h4>
<p id="index-31">There are many ways to store metadata about your experiments.
Already there are many fields in the various base classes
to store the more common or general metadata, such as wavelength.
(For wavelength, see the <a class="reference internal" href="strategies.html#strategies-wavelength"><em>Strategies: The wavelength</em></a> section.)</p>
<p>One common scheme is to store the metadata all in one
group.  If the group is to be validated for content,
then there are several possibilities, as shown in the next table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">base class</th>
<th class="head">intent</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="classes/base_classes/NXnote.html#nxnote"><em>NXnote</em></a></td>
<td>to store additional information</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="classes/base_classes/NXlog.html#nxlog"><em>NXlog</em></a></td>
<td>information that is time-stamped</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="classes/base_classes/NXparameters.html#nxparameters"><em>NXparameters</em></a></td>
<td>parameters for processing or analysis</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="classes/base_classes/NXcharacterization.html#nxcharacterization"><em>NXcharacterization</em></a></td>
<td>do not use this, as it may be removed later</td>
</tr>
</tbody>
</table>
<p>If the content of the metadata group is to be excluded from validation,
then store it in a <a class="reference internal" href="classes/base_classes/NXcollection.html#nxcollection"><em>NXcollection</em></a> group.</p>
</div>
</div>
<div class="section" id="nexus-application-definitions">
<span id="design-nexusapplications"></span><h3>1.2.1.6. NeXus Application Definitions<a class="headerlink" href="#nexus-application-definitions" title="Permalink to this headline">¶</a></h3>
<p>The objects described so far provide us with the means to store data from a wide variety of instruments,
simulations, or processed data as resulting from data analysis. But NeXus strives to express strict standards for
certain applications of NeXus, too. The tool which NeXus uses for the expression of such strict standards is the NeXus
<a class="reference internal" href="classes/applications/index.html#application-definitions"><em>Application Definition</em></a>.
A NeXus Application Definition describes which groups and data items have to be present in
a file in order to properly describe an application of NeXus. For example for describing  a powder diffraction
experiment. Typically an application definition will contain only a small subset of the many groups and fields
defined in NeXus. NeXus application definitions are also expressed in the NeXus Definition Language (NXDL). A tool exists
which allows one to validate a NeXus file against a given application definition.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">NeXus application definitions define the <em>minimum required</em> information
necessary to satisfy data analysis or other data processing.</p>
</div>
<p>Another way to look at a NeXus application definition is as a
contract between a file producer (writer) and a file consumer (reader).</p>
<blockquote>
<div>The contract reads:
<em>If you write your files following a particular NeXus application definition,
I can process these files with my software.</em></div></blockquote>
<p>Yet another way to look at a NeXus application definition is to understand it as an interface definition
between data files and the software which uses this file. Much like an interface in the Java or other modern
object oriented programming languages.</p>
<p>In contrast to NeXus base classes, NeXus supports inheritance in application definitions.</p>
<p>Please note that a NeXus Application Definition will only define the bare minimum of data necessary to perform
common analysis with data. Practical files will nearly always contain more data. One of the beauties of NeXus is
that it is always possible to add more data to a file without breaking its compliance with its application definition.</p>
</div>
</div>
<div class="section" id="nexus-coordinate-systems">
<span id="design-coordinatesystem"></span><span id="index-32"></span><h2>1.2.2. NeXus Coordinate Systems<a class="headerlink" href="#nexus-coordinate-systems" title="Permalink to this headline">¶</a></h2>
<p id="index-33">The NeXus coordinate system is shown <a class="reference internal" href="#fig-nexus-coord"><em>below</em></a>.
Note that it is the same as that used by <em>McStas</em> (<a class="reference external" href="http://mcstas.risoe.dk">http://mcstas.risoe.dk</a>).</p>
<div class="compound">
<blockquote class="compound-last" id="fig-nexus-coord">
<div><div class="figure">
<img alt="fig.coord.detector.view" src="_images/translation-orientation-geometry-2.jpg" style="width: 48%;" />
<p class="caption">NeXus coordinate system, as viewed from detector</p>
</div>
</div></blockquote>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The NeXus definition of <em>+z</em> is opposite to that
in the <span class="target" id="index-34"></span>IUCr
International Tables for Crystallography, volume G,
and consequently, <em>+x</em> is also reversed.</p>
</div>
<p><span class="target" id="index-35"></span>Coordinate systems
in NeXus have undergone significant development. Initially, only motor
positions of the relevant motors were stored without further standardization.
This soon proved to be
too little and the <em>NeXus polar coordinate</em> system
<span class="target" id="index-36"></span>was
developed. This system still
is very close to angles that are meaningful to an instrument scientist
but allows to define general positions of
components easily. Then users from the simulation community
approached the NeXus team and asked for a means
to store absolute coordinates. This was implemented through
the use of the <em>NXgeometry</em> class on top of the
<em>McStas</em> <span class="target" id="index-37"></span>system.
We soon learned that all the things we do can be expressed through the
McStas coordinate system. So it became the reference coordinate system
for NeXus. <tt class="docutils literal"><span class="pre">NXgeometry</span></tt> was expanded to allow the description of shapes
when the demand came up. Later, members of the
<span class="target" id="index-38"></span>CIF team
convinced the NeXus team of the beauty of transformation matrices and
NeXus was enhanced to store the necessary information to fully map CIF
concepts. Not much had to be changed though as we
choose to document the existing angles in CIF terms. The CIF system
allows to store arbitrary operations and nevertheless calculate
absolute coordinates in the laboratory coordinate system. It also
allows to convert from local, for example detector
coordinate systems, to absolute coordinates in the laboratory system.</p>
<p>Please note that NXgeometry and the polar coordinate system are suggested
to be deprecated. For new projects, rather use the CIF approach.</p>
<div class="section" id="mcstas-and-nxgeometry-system">
<span id="design-coordinate-nxgeometry"></span><h3>1.2.2.1. McStas and <tt class="docutils literal"><span class="pre">NXgeometry</span></tt> System<a class="headerlink" href="#mcstas-and-nxgeometry-system" title="Permalink to this headline">¶</a></h3>
<p id="index-39">As stated above, NeXus uses the
<em>McStas coordinate system</em> (<a class="reference external" href="http://mcstas.risoe.dk">http://mcstas.risoe.dk</a>)
as its laboratory coordinate system.
The instrument is given a global, absolute coordinate system where the
<em>z</em> axis points in the direction of the incident beam,
the <em>x</em> axis is perpendicular to the beam in the horizontal
plane pointing left as seen from the source, and the <em>y</em> axis
points upwards. See  below for a drawing of the McStas coordinate system.  The origin of this
coordinate system is the sample position or, if this is ambiguous, the center of the sample holder
with all angles and translations set to zero.  The McStas coordinate system is
illustrated in the next figure:</p>
<div class="compound">
<div class="compound-last figure align-center" id="fig-mcstas-coord">
<img alt="fig.mcstas-coord" src="_images/mcstascoord.png" style="width: 60%;" />
<p class="caption">The McStas Coordinate System</p>
</div>
</div>
<p>The NeXus NXgeometry class directly uses the
<span class="target" id="index-40"></span>McStas coordinate system.
<tt class="docutils literal"><span class="pre">NXgeometry</span></tt> classes can appear in any
component in order to specify its position.
The suggested name to use is geometry.
In <tt class="docutils literal"><span class="pre">NXgeometry</span></tt> the <tt class="docutils literal"><span class="pre">NXtranslation/values</span></tt>
field defines the absolute position of the component in the McStas coordinate system. The <tt class="docutils literal"><span class="pre">NXorientation/value</span></tt> field describes
the orientation of the component as a vector of in the McStas coordinate system.</p>
<p>Please note that it is planned to deprecate NXgeometry in favour of the transformation based
system described below.</p>
</div>
<div class="section" id="simple-spherical-polar-coordinate-system">
<span id="design-coordinate-spherical"></span><h3>1.2.2.2. Simple (Spherical Polar) Coordinate System<a class="headerlink" href="#simple-spherical-polar-coordinate-system" title="Permalink to this headline">¶</a></h3>
<p id="index-41">In this system,
the instrument is considered as a set of components through
which the incident beam passes. The variable <em>distance</em> is assigned to each component and represents the
effective beam flight path length between this component and the sample. A sign
convention is used where negative numbers represent components pre-sample and positive
numbers components post-sample. At each component there is local spherical coordinate system
with the angles <em>polar_angle</em> and <em>azimuthal_angle</em>.
The size of the sphere is the distance to the previous component.</p>
<p>In order to understand this spherical polar coordinate system it is helpful
to look initially at the common condition that <em>azimuthal_angle</em>
is zero. This corresponds to working directly in the horizontal scattering
plane of the instrument. In this case <em>polar_angle</em> maps
directly to the setting commonly known as <em>two theta</em>.
Now, there are instruments where components live outside of the scattering plane.
Most notably detectors. In order to describe such components we first apply
the tilt out of the horizontal scattering plane as the
<em>azimuthal_angle</em>. Then, in this tilted plane, we rotate
to the component. The beauty of this is that <em>polar_angle</em>
is always <em>two theta</em>. Which, in the case of a component
out of the horizontal scattering plane, is not identical to the value read
from the motor responsible for rotating the component. This situation is shown in
<a class="reference internal" href="#fig-polar-geometry-figure"><em>Polar Coordinate System</em></a>.</p>
<div class="compound">
<div class="compound-last figure align-center" id="fig-polar-geometry-figure">
<img alt="fig.polar-geometry-figure" src="_images/polplane.png" style="width: 60%;" />
<p class="caption">NeXus Simple (Spherical Polar) Coordinate System</p>
</div>
</div>
<dl class="docutils">
<dt>Please note that it is planned to deprecate this polar system in favour of the transformation based</dt>
<dd>system described below.</dd>
</dl>
</div>
<div class="section" id="coordinate-transformations">
<span id="coordinatetransformations"></span><h3>1.2.2.3. Coordinate Transformations<a class="headerlink" href="#coordinate-transformations" title="Permalink to this headline">¶</a></h3>
<p id="index-42">Another way to look at coordinates is through
the use of <span class="target" id="index-43"></span>transformation matrices.
In this world view, the absolute position of a component or a detector pixel with respect to
the laboratory coordinate system is calculated by applying a series of translations and
rotations. These operations are commonly expressed as transformation matrices and their
combination as matrix multiplication. A very important aspect is that the order of application
of the individual operations <em>does</em> matter. Another important aspect is that
any operation transforms the whole coordinate system and gives rise to a new local coordinate system.
The mathematics behind this is
well known and used in such applications such as industrial robot control, space flight and
computer games. The beauty in this comes from the fact that the operations to apply map easily
to instrument settings and constants. It is also easy to analyze the contribution of each individual
operation: this can be studied under the condition that all other operations are at a zero setting.</p>
<p>In order to use coordinate transformations, several morsels of information need to be known:</p>
<blockquote>
<div><dl class="docutils">
<dt><strong>Type</strong></dt>
<dd>The type of operation: rotation or translation</dd>
<dt><strong>Direction</strong></dt>
<dd>The direction of the translation or the direction of the rotation axis</dd>
<dt><strong>Value</strong></dt>
<dd>The angle of rotation or the length of the translation</dd>
<dt><strong>Order</strong></dt>
<dd>The order of operations to apply to move a component into its place.</dd>
</dl>
</div></blockquote>
<p>NeXus chooses to encode this information in the following way:</p>
<blockquote>
<div><dl class="docutils" id="index-44">
<dt><strong>Type</strong></dt>
<dd>Through a data set attribute <strong>transformation_type</strong>.
This can take the value of either <em>translation</em>
or <em>rotation</em>.</dd>
</dl>
<dl class="docutils" id="index-45">
<dt><strong>Direction</strong></dt>
<dd>Through a data set attribute <strong>vector</strong>. This is a set of three values
describing either the components of the rotation axis
or the direction along which the translation happens.</dd>
</dl>
<dl class="docutils" id="index-46">
<dt><strong>Value</strong></dt>
<dd>This is represented in the actual data of the data set. In addition, there is the
<strong>offset</strong> attribute which has three components describing a translation to apply before
applying the operation of the real axis. Without the offset attribute additional virtual
translations would need to be introduced in order to encode mechanical offsets in the axis.</dd>
</dl>
<dl class="docutils" id="index-47">
<dt><strong>Order</strong></dt>
<dd><p class="first">The order is encoded through the <strong>depends_on</strong> attribute on a data set. The value of the
<strong>depends_on</strong> attribute is the axis upon which the current axis sits.
If the axis sits in the same group it is just a name,
if it is in another group it is a path to the dependent axis.
In addition, for each beamline component, there is a <strong>depends_on</strong> field which points to the data set at the
head of the axis dependency chain. Take as an example an <span class="target" id="index-48"></span>eulerian cradle as used on a
<span class="target" id="index-49"></span>four-circle diffractometer. Such a cradle has a dependency chain of <tt class="docutils literal"><span class="pre">phi:chi:rotation_angle</span></tt>. Then
the <tt class="docutils literal"><span class="pre">depends_on</span></tt> field in <a class="reference internal" href="classes/base_classes/NXsample.html#nxsample"><em>NXsample</em></a> would have the value <tt class="docutils literal"><span class="pre">phi</span></tt>.</p>
<div class="last compound">
<p class="compound-first rubric">NeXus Transformation encoding</p>
<p class="compound-middle" id="table-eulercif">Transformation encoding for an eulerian cradle on a four-circle diffractometer</p>
<div class="compound-last highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="nl">sample:</span><span class="n">NXsample</span>
                <span class="n">rotation_angle</span>
                  <span class="err">@</span><span class="n">transformation_type</span><span class="o">=</span><span class="n">rotation</span>
                  <span class="err">@</span><span class="n">vector</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
                  <span class="err">@</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">chi</span>
                  <span class="err">@</span><span class="n">transformation_type</span><span class="o">=</span><span class="n">rotation</span>
                  <span class="err">@</span><span class="n">vector</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
                  <span class="err">@</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                  <span class="err">@</span><span class="n">depends_on</span><span class="o">=</span><span class="n">rotation_angle</span>
                <span class="n">phi</span>
                  <span class="err">@</span><span class="n">transformation_type</span><span class="o">=</span><span class="n">rotation</span>
                  <span class="err">@</span><span class="n">vector</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span>
                  <span class="err">@</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                  <span class="err">@</span><span class="n">depends_on</span><span class="o">=</span><span class="n">chi</span>
                <span class="n">depends_on</span> 
                  <span class="n">phi</span>
</pre></div>
</td></tr></table></div>
</div>
</dd>
</dl>
</div></blockquote>
<p>The type and direction of the NeXus standard operations is documented below
in the table: <a class="reference internal" href="#tb-table-transform"><em>Actions of standard NeXus fields</em></a>.
The rule is to always give the attributes to make perfectly clear how the axes work. The <span class="target" id="index-50"></span>CIF scheme
also allows to store and use arbitrarily named axes in a NeXus file.</p>
<div class="compound">
<p class="compound-middle rubric" id="tb-table-transform">Actions of standard NeXus fields</p>
<p class="compound-middle"><a class="reference internal" href="#tb-table-transform"><em>Transformation Actions</em></a></p>
<table border="1" class="compound-last docutils">
<colgroup>
<col width="35%" />
<col width="44%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field Name</th>
<th class="head">transformation_type</th>
<th class="head">vector</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>polar_angle</td>
<td>rotation</td>
<td>0 1 0</td>
</tr>
<tr class="row-odd"><td>azimuthal_angle</td>
<td>rotation</td>
<td>0 0 1</td>
</tr>
<tr class="row-even"><td>meridional_angle</td>
<td>rotation</td>
<td>1 0 0</td>
</tr>
<tr class="row-odd"><td>distance</td>
<td>translation</td>
<td>0 0 1</td>
</tr>
<tr class="row-even"><td>height</td>
<td>translation</td>
<td>0 1 0</td>
</tr>
<tr class="row-odd"><td>x_translation</td>
<td>translation</td>
<td>1 0 0</td>
</tr>
<tr class="row-even"><td>chi</td>
<td>rotation</td>
<td>0 0 1</td>
</tr>
<tr class="row-odd"><td>phi</td>
<td>rotation</td>
<td>0 1 0</td>
</tr>
</tbody>
</table>
</div>
<p>For the NeXus spherical coordinate system, the order is implicit and is given in the next example.</p>
<blockquote>
<div><div class="compound">
<p class="compound-first rubric">implicit order of NeXus spherical coordinate system</p>
<div class="compound-last highlight-text"><div class="highlight"><pre>azimuthal_angle:polar_angle:distance
</pre></div>
</div>
</div>
</div></blockquote>
<p>This is also a nice example of the application of transformation matrices:</p>
<ol class="arabic simple">
<li>You first apply <tt class="docutils literal"><span class="pre">azimuthal_angle</span></tt> as a rotation
around <em>z</em>.  This rotates the whole coordinate out of the plane.</li>
<li>Then you apply <tt class="docutils literal"><span class="pre">polar_angle</span></tt> as a rotation around
<em>y</em> in the tilted coordinate system.</li>
<li>This also moves the direction of the <em>z</em> vector.
Along which you translate the component to place by distance.</li>
</ol>
</div>
</div>
<div class="section" id="rules-and-underlying-file-formats">
<h2>1.2.3. Rules and Underlying File Formats<a class="headerlink" href="#rules-and-underlying-file-formats" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="rules.html">1.2.3.1. Rules for Structuring Information in NeXus Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="datarules.html">1.2.3.2. Rules for Storing Data Items in NeXus Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="fileformat.html">1.2.3.3. Physical File format</a></li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="rules.html" title="1.2.3.1. Rules for Structuring Information in NeXus Files"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction-napi.html" title="NAPI: The NeXus Application Programming Interface"
             >previous</a> |</li>
        <li><a href="index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="user_manual.html" >1. NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="copyright.html">Copyright</a> 2014, http://nexusformat.org.
      Last updated on 2014-10-02 14:43:08 CDT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>